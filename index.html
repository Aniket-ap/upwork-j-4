<html>

<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/somethinggoodone/cdn/AniketPradhan_bootstrap.css" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
		crossorigin="anonymous"></script>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
	<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
	<style>
		input,
		select,
		textarea {
			text-overflow: ellipsis
		}

		button:active,
		button:focus {
			outline-color: #c6a5ff
		}

		.bg-theme {
			background: rgba(103, 58, 183, .07) !important
		}

		.text-theme {
			color: #673ab7
		}

		* {
			font-size: 14px
		}

		input[readonly] {
			background-color: transparent !important;
			cursor: inherit
		}

		.nav-link.active,
		.textbutton,
		label {
			color: #374151 !important;
			font-weight: 500 !important
		}

		.initial {
			font-size: initial !important
		}

		.hide {
			display: none
		}

		.name {
			background-color: transparent;
			font-weight: 400;
			outline: 0;
			width: 50%
		}

		.name:focus {
			border-bottom: 2px solid #673ab7 !important
		}

		.list-group-item-action:hover svg path {
			fill: #673ab7
		}

		.bottom,
		.bottom-left,
		.bottom-right,
		.button-bar,
		.button-bar-right {
			bottom: 0 !important;
			position: absolute !important
		}

		.bottom-right,
		.button-bar-right {
			right: 0 !important
		}

		.flx-row {
			display: flex;
			justify-content: space-between
		}

		.accordion-button {
			display: unset !important
		}

		.accordion-button:not(.collapsed) {
			border-left: 1px solid var(--bs-border-color);
			border-right: 1px solid var(--bs-border-color);
			border-top: 1px solid var(--bs-border-color);
			transition: ease .25s
		}

		.accordion-button:not(.collapsed) .wdesc {
			display: none !important;
			animation: 5s fadeIn !important;
			animation-fill-mode: forwards !important
		}

		.accordion-button:not(.collapsed) .name {
			font-weight: 500 !important
		}

		.accordion-body {
			border-left: 1px solid var(--bs-border-color);
			border-bottom: 1px solid var(--bs-border-color);
			border-right: 1px solid var(--bs-border-color)
		}

		.search {
			width: -webkit-fill-available
		}

		.info-icon {
			color: #673ab7;
			font-size: large;
			font-weight: 900
		}

		.material-symbols-outlined {
			font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 40
		}

		.icon-text-primary {
			opacity: .5 !important
		}

		.icon-text-primary:hover {
			opacity: 1 !important
		}

		.picker-dialog-bg {
			z-index: 200000 !important
		}

		.picker-dialog {
			z-index: 200001 !important
		}

		.messagemodal {
			z-index: 200004 !important
		}

		.icon32 {
			width: 32px
		}
		.form-check{
			margin-bottom: 0 !important;
		}
	</style>
</head>

<body>
	<button type="button" class="m-3 btn btn-primary" id="email">Send Email</button>
	<button type="button" class="m-3 btn btn-outline-secondary" id="restoreall">Restore All</button>
	<button type="button" class="m-3 btn btn-outline-secondary" id="sendall">Send All</button>
	<hr>
	<ul class="list-group" id="tasks-point-l9zgqjql"></ul>
	<div id="modal"></div>
	<script>
		function atoo(f, b) {
			var c = [],
				d = !1;
			f.forEach(function (g, e) {
				var a = {};
				a.key = g;
				a.value = 0 === b[e].length ? "" : b[e];
				"" === a.key.trim() && "" !== a.value ? d = !0 : "" !== a.key.trim() && c.push(a);
			});
			return d ? !1 : c;
		}

		function getAddTaskEnvelope(wid, tid, tasktype, task_body) {
			return `<li class="border-top-0 border-end-0 border-start-0 list-group-item tsk-${wid}-${tid} ${tasktype}" data-id="${wid}-${tid}" data-type="${tasktype}">
			<img src="https://img.icons8.com/color/48/null/gmail-new.png" class="float-start" />
			<div class="btn-group float-end">
				<button type="button" class="btn dropdown-toggle btn-light" data-bs-toggle="dropdown" aria-expanded="false"> Actions </button>
				<ul class="dropdown-menu dropdown-menu-lg-end">
					<li><a data-bs-toggle="modal" href="#task-modal-${wid}-${tid}" role="button" class="dropdown-item" href="#">Edit</a></li>
					<li><a class="dropdown-item" href="#">Duplicate</a></li>
					<li><a class="dropdown-item tdelete" href="#">Delete</a></li>
				</ul>
			</div>
			${task_body}
		</li>`
		}

		function getEmailValues(wid, tid) {
			let result = {};
			result.taskType = "email";
			result.id = tid;
			result.name = `${wid}-${tid}`;
			// Page setup
			function pageSetupTabRedirect() {
				$(`[data-bs-target="#nav-page-setup-${wid}-${tid}"]`).trigger('click');
			}
			// Print
			let printValue = $(`#print-${wid}-${tid}`).val();
			let printTextValue = $(`#print-${wid}-${tid} option:selected`).text();
			if (printTextValue.indexOf("Selected range of ") == 0) {
				let rangeVal = $(`#print-range-${wid}-${tid}`).val();
				if (rangeVal.trim().length === 0) {
					pageSetupTabRedirect();
					alert("Range should not be empty in Page setup tab");
					return;
				} else {
					result.print = {
						"type": "custom",
						"value": [{
							"sheet": `${printValue}`,
							"range": `${rangeVal}`
						}]
					}
				}
			} else if (printValue === "workbook") {
				let webworkVal = $(`.selection-${wid}-${tid} > input`).val();
				if (webworkVal === "All Sheets") {
					result.print = {
						"type": "workbook"
					}
				} else {
					let arr = [];
					$(`.selection-${wid}-${tid} :checkbox:checked`).each(function () {
						arr.push({
							"sheet": $(this).val()
						});
					});
					result.print = {
						"type": "workbook",
						"value": arr
					}
				}
			} else {
				result.print = {
					"type": "custom",
					"value": [{
						"sheet": `${printValue}`
					}]
				}
			}
			// Paper Size
			let paperSizeVal = $(`#size-${wid}-${tid}`).val();
			let height;
			let width;
			if (paperSizeVal == "custom") {
				height = $(`#size-height-${wid}-${tid}`).val();
				width = $(`#size-width-${wid}-${tid}`).val();
				if (height.trim().length === 0 || width.trim().length === 0) {
					pageSetupTabRedirect();
					alert("Height and Width should not be empty in Page setup tab");
					return;
				}
				if (width < 2.5) {
					pageSetupTabRedirect()
					alert(`Please enter Page Width value greater than 2.5" in Paper size`);
					return;
				}
				if (height < 2.5) {
					pageSetupTabRedirect()
					alert(`Please enter Page Height value greater than 2.5" in Paper size`);
					return;
				}
				if (height > 60 || width > 60) {
					pageSetupTabRedirect()
					alert(`Please enter a number no greater than 60" in Paper size`);
					return;
				}
				result.size = {
					"type": "custom",
					"value": {
						"height": `${height}`,
						"width": `${width}`,
					}
				}
			} else {
				width = $(`#size-${wid}-${tid}`).find(':selected').attr('data-width');
				height = $(`#size-${wid}-${tid}`).find(':selected').attr('data-height');
				result.size = {
					"type": `${paperSizeVal}`
				}
			}
			// Scale
			let scaleVal = $(`#scale-${wid}-${tid}`).val();
			if (scaleVal == "custom") {
				let percentageVal = Math.round($(`#percentage-${wid}-${tid}`).val());
				if (Number(percentageVal) < 1 || percentageVal.length === 0) {
					pageSetupTabRedirect();
					alert("Please enter a positive Percentage value ");
					return;
				}
				result.scale = {
					"type": "custom",
					"value": {
						"percentage": `${percentageVal / 100}`,
					}
				}
			} else if (scaleVal == "fit_pagebreak") {
				let row = $(`#break-row-${wid}-${tid}`).val();
				let col = $(`#break-column-${wid}-${tid}`).val();
				if (col > 18278) {
					pageSetupTabRedirect();
					alert("Please enter a value less then 18278");
					return;
				}
				result.scale = {
					"type": "fit_pagebreak",
					"value": {
						"row": Number(`${row}`),
						"column": Number(`${col}`)
					}
				}
			} else {
				result.scale = {
					"type": `${scaleVal}`
				}
			}
			// Margins
			let marginsVal = $(`#margins-${wid}-${tid}`).val();
			if (marginsVal == "custom") {
				let top = $(`#margins-top-${wid}-${tid}`).val();
				let left = $(`#margins-left-${wid}-${tid}`).val();
				let right = $(`#margins-right-${wid}-${tid}`).val();
				let bottom = $(`#margins-bottom-${wid}-${tid}`).val();
				if (top.trim().length === 0 || left.trim().length === 0 || right.trim().length === 0 || bottom.trim().length === 0) {
					pageSetupTabRedirect();
					alert("Margins Top, Left, Right and Bottom value should not be empty in Page setup tab");
					return;
				}
				if (top > (height - 1) || bottom > (height - 1)) {
					alert(`The maximum value of the Top/Bottom Margin for the specified paper size is ${height - 1}`)
					return;
				}
				if (left > (width - 1) || right > (width - 1)) {
					alert(`The maximum value of the Left/Right Margin for the specified paper size is ${width - 1}`)
					return;
				}
				let maxTopValue = (height - 1) - bottom;
				let maxBottomValue = (height - 1) - top;
				let maxLeftValue = (width - 1) - right;
				let maxRightValue = (width - 1) - left;
				if (top >= bottom && (top < 0 || top > maxTopValue)) {
					pageSetupTabRedirect();
					alert(`Enter the Top margin number between 0 and ${maxTopValue}`);
					return;
				}
				if (left >= right && (left < 0 || left > maxLeftValue)) {
					pageSetupTabRedirect();
					alert(`Enter the Left margin number between 0 and ${maxLeftValue}`);
					return;
				}
				if (right >= left && (right < 0 || right > maxRightValue)) {
					pageSetupTabRedirect();
					alert(`Enter the Right margin number between 0 and ${maxRightValue}`);
					return;
				}
				if (bottom >= top && (bottom < 0 || bottom > maxBottomValue)) {
					pageSetupTabRedirect();
					alert(`Enter the Bottom margin number between 0 and ${maxBottomValue}`);
					return;
				}
				result.margins = {
					"type": "custom",
					"value": {
						"top": Number(`${top}`),
						"left": Number(`${left}`),
						"right": Number(`${right}`),
						"bottom": Number(`${bottom}`),
					}
				}
			} else {
				result.margins = {
					"type": `${marginsVal}`
				}
			}
			// Page Orietation
			let selectedRadioValue = $("input[name='pageSetupRadio']:checked").val();
			result.orientation = {
				"type": `${selectedRadioValue}`
			}
			// Format tab
			// gridlines
			result.gridlines = {
				"value": $(`#showgridlines-${wid}-${tid}`).is(":checked")
			}
			// notes
			result.notes = {
				"value": $(`#shownotes-${wid}-${tid}`).is(":checked")
			}
			// Pageorder
			let pageOrderVal = $(`#pageorder-${wid}-${tid}`).val();
			result.pageorder = {
				"value": `${pageOrderVal}`
			}
			// Alignment
			result.h_alignment = {
				"value": $(`#horizontal-alignment-${wid}-${tid}`).val()
			}
			result.v_alignment = {
				"value": $(`#vertical-alignment-${wid}-${tid}`).val()
			}
			// Headers & Footer
			result.hf = {
				"options": {
					"hf_fzr": $(`#frozen-rows-${wid}-${tid}`).is(":checked"),
					"hf_fzc": $(`#frozen-columns-${wid}-${tid}`).is(":checked")
				},
				"type": "custom",
				"value": {
					"top_left": $(`#top-left-${wid}-${tid}`).val(),
					"top_center": $(`#top-middle-${wid}-${tid}`).val(),
					"top_right": $(`#top-right-${wid}-${tid}`).val(),
					"bottom_left": $(`#bottom-left-${wid}-${tid}`).val(),
					"bottom_center": $(`#bottom-middle-${wid}-${tid}`).val(),
					"bottom_right": $(`#bottom-right-${wid}-${tid}`).val(),
				}
			}
			return result;
		}
		// Dynamic columnName
		function toColumnName(d) {
			for (var a = "", b = 1, c = 26; 0 <= (d -= b); b = c, c *= 26) a = String.fromCharCode(parseInt(d % c / b) + 65) + a;
			return a
		};

		function createTask_Email(wid, task) {
			var tid = task?.id ? task.id : Math.random().toString(36).substr(2, 8);
			var html_task = getAddTaskEnvelope(wid, tid, "email", `<div class="ms-5 ps-3">
	<span class="task-title">Email: ${wid}-${tid} </span><br>
	<span class="text-secondary small">Last updated </span><span class="time text-secondary small" data-time="1667889127596">15 days ago</span>
</div>
<div class="modal fade" id="task-modal-${wid}-${tid}" aria-hidden="true" aria-labelledby="task-modal-label-${wid}-${tid}" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
			<div class="modal-header border border-bottom-0 bg-theme">
				<img style="width:25px;" src="https://img.icons8.com/color/48/null/gmail-new.png" class="float-start">&nbsp;
				<span class="modal-title fw-bolder ms-1 ps-0" id="task-modal-label-${wid}-${tid}">Create New Email Instance</span>
				<button type="button" class="me-1 btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body border">
				<!--Modal body goes here.-->
				<div class="container mt-5">
					<div id="email-container-${wid}-${tid}" >
							<table border="0" width="100%" style="table-layout:fixed;">
								<tbody>
									<tr>
										<td colspan="3">
											<span class="pb-2 fw-bolder">Email Service</span><br>
											<span class="text-secondary">You may choose to send emails through Gmail, Amazon SES, SendGrid, SparkPost</span><br>
										</td>
									</tr>
									<tr>
										<td class="p-3" colspan="3">
											<label for="service-provider-${wid}-${tid}" class="form-label">Service Provider</label>
											<select class="form-select" id="service-provider-${wid}-${tid}">
												<option value="gmail">Gmail</option>
												<option value="amazon">Amazon SES</option>
												<option value="sendgrid">SendGrid</option>
												<option value="sparkpost">SparkPost</option>
											</select>
										</td>
									</tr>
									<tr class="aws-row-${wid}-${tid}">
										<td class="p-3">
											<label for="aws-region-${wid}-${tid}" class="form-label">AWS Region</label>
											<select class="form-select" id="aws-region-${wid}{tid}">
												<option value="">Choose AWS Region...</option>
												<option value="us-east-2">US East (Ohio)</option>
												<option value="us-east-1">US East (N. Virginia)</option>
												<option value="us-west-1">US West (N. California)</option>
												<option value="us-west-2">US West (Oregon)</option>
												<option value="af-south-1">Africa (Cape Town)</option>
												<option value="ap-south-1">Asia Pacific (Mumbai)</option>
												<option value="ap-northeast-2">Asia Pacific (Seoul)</option>
												<option value="ap-southeast-1">Asia Pacific (Singapore)</option>
												<option value="ap-southeast-2">Asia Pacific (Sydney)</option>
												<option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
												<option value="ca-central-1">Canada (Central)</option>
												<option value="eu-central-1">Europe (Frankfurt)</option>
												<option value="eu-west-1">Europe (Ireland)</option>
												<option value="eu-west-2">Europe (London)</option>
												<option value="eu-south-1">Europe (Milan)</option>
												<option value="eu-west-3">Europe (Paris)</option>
												<option value="eu-north-1">Europe (Stockholm)</option>
												<option value="me-south-1">Middle East (Bahrain)</option>
												<option value="sa-east-1">South America (São Paulo)</option>
												<option value="us-gov-west-1">AWS GovCloud (US-West)</option>
											</select>
										</td>
										<td class="p-3">
											<label for="ses-key-${wid}-${tid}" class="form-label">SES Key id</label>
											<input type="text" class="form-control" id="ses-key-${wid}-${tid}" />
										</td>
										<td class="p-3">
											<label for="ses-secret-${wid}-${tid}" class="form-label">SES Secret</label>
											<input type="text" class="form-control" id="ses-secret-${wid}-${tid}" />
										</td>
									</tr>
									<tr class="sendgrid-row-${wid}-${tid}">
										<td colspan="3" class="p-3">
											<label for="sendgrid-api-${wid}-${tid}" class="form-label">SendGrid API Key</label>
											<input type="text" class="form-control" id="sendgrid-api-${wid}-${tid}" />
										</td>
									</tr>
									<tr class="sparkpost-row-${wid}-${tid}">
										<td colspan="3" class="p-3">
											<label for="sparkpost-api-${wid}-${tid}" class="form-label">SparkPost API Key</label>
											<input type="text" class="form-control" id="sparkpost-api-${wid}-${tid}" />
										</td>
									</tr>
									<tr class="gmail-row-${wid}-${tid}">
										<td colspan="2" class="p-3">
											<label for="sender-name-${wid}-${tid}" class="form-label">Sender Name</label>
											<input type="text" class="form-control" id="sender-name-${wid}-${tid}" />
										</td>
										<td class="p-3">
											<label for="sender-email-${wid}-${tid}" class="form-label">Sender Email</label>
											<select class="form-select" id="sender-email-${wid}-${tid}">
											</select>
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<hr>
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<span class="pb-2 fw-bolder">Recipients</span><br>
											<span class="text-secondary">Specify one or more email addresses separated by comma that your emails should be sent to</span><br>
										</td>
									</tr>
									<tr>
										<td class="p-3">
											<label for="to-recipients-${wid}-${tid}" class="form-label">To</label>
											<input type="text" class="form-control" id="to-recipients-${wid}-${tid}" />
										</td>
										<td class="p-3">
											<label for="cc-${wid}-${tid}" class="form-label">CC</label>
											<input type="text" class="form-control" id="cc-${wid}-${tid}" />
										</td>
										<td class="p-3">
											<label for="bcc-${wid}-${tid}" class="form-label">BCC</label>
											<input type="text" class="form-control" id="bcc-${wid}-${tid}" />
										</td>
									</tr>
									<tr>
										<td colspan="2" class="p-3">
											<label for="reply-email-${wid}-${tid}" class="form-label">Reply-to Email</label>
											<select class="form-select" id="reply-email-${wid}-${tid}">
											</select>
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<hr>
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<span class="pb-2 fw-bolder">Subject & Message</span><br>
											<span class="text-secondary">Specify the subject line and body of your message. Use markers for personalized subject and body</span>
										</td>
									</tr>
									<tr>
										<td class="p-3" colspan="2">
											<label for="email-subject-${wid}-${tid}" class="form-label">Subject</label>
											<input type="text" class="form-control" id="email-subject-${wid}-${tid}" />
										</td>
										<td class="p-3">
											<label for="editor-type-${wid}-${tid}" class="form-label">Editor type</label>
											<select class="form-select" id="editor-type-${wid}-${tid}">
												<option selected value="wysiwyg">WYSIWYG</option>
												<option value="html">HTML</option>
												<option value="docs">Google Docs</option>
											</select>
										</td>
									</tr>
									<tr class="email-body-section-${wid}-${tid}">
										<td class="p-3" colspan="3">
											<label for="email-body-${wid}-${tid}" class="form-label">Email Body</label>
											<div id="editor-${wid}-${tid}">
												
											</div>
										</td>
									<tr/>
									<tr class="email-bodyhtml-section-${wid}-${tid}">
										<td class="p-3" colspan="3">
											<label for="email-body-html-${wid}-${tid}" class="form-label">Email Body</label>
											<div id="editor-html-${wid}-${tid}">
												
											</div>
										</td>
									</tr>
									<tr class="google-docs-section-${wid}-${tid}">
										<td class="p-3" colspan="2">
											<input id="template_mime-${wid}-${tid}" type="text" class="hide form-control" readonly>
											<label for="template_email_pick-${wid}-${tid}">Google Docs Template<sup class="text-danger">*</sup>
												<a class="hide openlink" href=""><i class="initial material-symbols-outlined icon-text-primary align-middle">open_in_new</i></a>
											</label>
											<div class="input-group">
												<input id="template_name-${wid}-${tid}" type="text" class="form-control" aria-label="Choose Docs Template" readonly>
												<button class="btn btn-outline-primary" type="button" id="template_email_pick-${wid}-${tid}"><span class="initial align-middle align-middle material-symbols-outlined">folder_open</span>&nbsp;<span class="btn-text">Choose</span></button>
											</div>
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<hr>
										</td>
									</tr>									
									<tr>
										<td colspan="3">
											<span class="pb-2 fw-bolder">File Attachments</span><br>
											<span class="text-secondary">You can attach files or include merged file linkes from Google Drive How to do it?</span><br>
										</td>
									</tr>
									<tr>
										<td colspan="3" class="p-3">
											<div class="form-check">
												<input class="form-check-input" type="checkbox" value="" id="attach-all-merged-${wid}-${tid}" checked>
												<label class="fw-normal" for="attach-all-merged-${wid}-${tid}">
													Attach all merged files generated in this workflow
												</label>
											</div>
											<div class="form-check">
												<input class="form-check-input" type="checkbox" value="" id="attach-google-form-${wid}-${tid}" >
												<label class="fw-normal" for="attach-google-form-${wid}-${tid}">
													Attach Google Form uploaded Files (if any)
												</label>
											</div>	
										</td>	
									</tr>
								</tbody>
							</table>
						</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-secondary restore-${wid}-${tid}">Restore</button>
				<button type="submit" class="btn btn-primary done-${wid}-${tid}">Done</button>
			</div>
		</div>
	</div>
</div>`);
			$(`#tasks-point-${wid}`).append(html_task);
			if (!task) $(`#task-modal-${wid}-${tid}`).modal("show");
			// Hide all the row initially
			$(`.sparkpost-row-${wid}-${tid}, .sendgrid-row-${wid}-${tid}, .aws-row-${wid}-${tid}, .gmail-row-${wid}-${tid}, .email-bodyhtml-section-${wid}-${tid}, .google-docs-section-${wid}-${tid}`).hide();
			
			var SENDERS_EMAILS = [{email:"somethinggoodone@gmail.com"},{email:"example@gmail.com"}]
			SENDERS_EMAILS.forEach((data, index) => {
				$(`#sender-email-${wid}-${tid}`).append(`<option value="${index}">${data.email}</option>`);
			})
			
			var REPLY_TO_EMAILS = [{email:"somethinggoodone@gmail.com"},{email:"example@gmail.com"}]
			REPLY_TO_EMAILS.forEach((data, index) => {
				$(`#reply-email-${wid}-${tid}`).append(`<option value="${index}">${data.email}</option>`);
			})

			$(`#editor-type-${wid}-${tid}`).on("change", function () {
				var value = $(this).children('option:selected').val();
				if (value === "wysiwyg") {
					$(`.email-bodyhtml-section-${wid}-${tid}, .google-docs-section-${wid}-${tid}`).hide();
					$(`.email-body-section-${wid}-${tid}`).show();
				} else if (value === "html") {
					$(`.email-bodyhtml-section-${wid}-${tid}`).show();
					$(`.email-body-section-${wid}-${tid}, .google-docs-section-${wid}-${tid}`).hide();
				} else {
					$(`.google-docs-section-${wid}-${tid}`).show();
					$(`.email-body-section-${wid}-${tid}, .email-bodyhtml-section-${wid}-${tid}`).hide();
				}
			})
			$(`#service-provider-${wid}-${tid}`).on("change", function () {
				var value = $(this).children('option:selected').val();
				if (value === "gmail") {
					$(`.gmail-row-${wid}-${tid}`).show();
					$(`.sparkpost-row-${wid}-${tid}, .sendgrid-row-${wid}-${tid}, .aws-row-${wid}-${tid}`).hide();
				} else if (value === "amazon") {
					$(`.aws-row-${wid}-${tid}`).show();
					$(`.sparkpost-row-${wid}-${tid}, .sendgrid-row-${wid}-${tid}, .gmail-row-${wid}-${tid}`).hide();
				} else if (value === "sendgrid") {
					$(`.sendgrid-row-${wid}-${tid}`).show();
					$(`.sparkpost-row-${wid}-${tid}, .aws-row-${wid}-${tid}, .gmail-row-${wid}-${tid}`).hide();
				} else if (value === "sparkpost") {
					$(`.sparkpost-row-${wid}-${tid}`).show();
					$(`.sendgrid-row-${wid}-${tid}, .aws-row-${wid}-${tid}, .gmail-row-${wid}-${tid}`).hide();
				} else {
					$(`.sparkpost-row-${wid}-${tid}, .sendgrid-row-${wid}-${tid}, .aws-row-${wid}-${tid}, .gmail-row-${wid}-${tid}`).hide();
				}
			}).trigger("change")
			$(`.restore-${wid}-${tid}`).on('click', function (e) {
				console.log("Restore called")
				if (!task) return;
				var pj = task;
				// Page Setup
				// Print
				if (pj.print.type === "workbook") {
					$(`#print-${wid}-${tid}`).val(pj.print.type).trigger("change");
					$(`.selection-${wid}-${tid} :checkbox`).prop('checked', false); //deselect all
					$(`.selection-${wid}-${tid} :checkbox`).each(function () {
						pj.print.value.forEach((val) => {
							if (val.sheet === $(this).val()) {
								$(this).prop('checked', true).trigger("change");
							}
						})
					}).trigger("change");
				} else if (pj.print.type === "custom") {
					if (pj.print.value[0].hasOwnProperty("range")) {
						optionText = `Selected range of ${pj.print.value[0].sheet}`;
						$(`#print-range-${wid}-${tid}`).val(pj.print.value[0].range)
					} else optionText = `${pj.print.value[0].sheet}`
					$(`#print-${wid}-${tid} option`).removeAttr('selected').map(function () {
						if ($(this).text() === optionText) return this;
					}).attr('selected', true).trigger("change");
				}
				// Paper size
				if (pj.size.type === "custom") {
					$(`#size-${wid}-${tid}`).val(pj.size.type).trigger("change");
					$(`#size-height-${wid}-${tid}`).val(pj.size.value.height);
					$(`#size-width-${wid}-${tid}`).val(pj.size.value.width);
				} else {
					$(`#size-${wid}-${tid}`).val(pj.size.type).trigger("change");
				}
				// Margins
				if (pj.margins.type === "custom") {
					$(`#margins-${wid}-${tid}`).val(pj.margins.type).trigger("change");
					$(`#margins-top-${wid}-${tid}`).val(pj.margins.value.top);
					$(`#margins-left-${wid}-${tid}`).val(pj.margins.value.left);
					$(`#margins-right-${wid}-${tid}`).val(pj.margins.value.right);
					$(`#margins-bottom-${wid}-${tid}`).val(pj.margins.value.bottom);
				} else {
					$(`#margins-${wid}-${tid}`).val(pj.margins.type).trigger("change");
				}
				// Scale
				if (pj.scale.type === "custom") {
					$(`#scale-${wid}-${tid}`).val(pj.scale.type).trigger("change");
					$(`#percentage-${wid}-${tid}`).val(pj.scale.value.percentage * 100);
				} else if (pj.scale.type == "fit_pagebreak") {
					console.log("calling " + pj.scale.type);
					$(`#scale-${wid}-${tid}`).val(pj.scale.type).trigger("change");
					$(`#break-row-${wid}-${tid}`).val(pj.scale.value.row)
					$(`#break-column-${wid}-${tid}`).val(pj.scale.value.column).trigger("change");
				} else {
					$(`#scale-${wid}-${tid}`).val(pj.scale.type).trigger("change");
				}
				// Set page orientation
				$("input[name='pageSetupRadio']").val([`${pj.orientation.type}`])
				// Formatting Tab
				$(`#pageorder-${wid}-${tid}`).val(pj.pageorder.value).trigger("change");
				$(`#horizontal-alignment-${wid}-${tid}`).val(pj.h_alignment.value).trigger("change");
				$(`#vertical-alignment-${wid}-${tid}`).val(pj.v_alignment.value).trigger("change");
				if (pj.notes.value === "true") {
					$(`#shownotes-${wid}-${tid}`).prop('checked', true);
				}
				if (pj.gridlines.value === "true") {
					$(`#showgridlines-${wid}-${tid}`).prop('checked', true);
				}
				// Headers and Footers tab
				if (pj.hf.options.hf_fzr) {
					$(`#frozen-rows-${wid}-${tid}`).prop('checked', true);
				}
				if (pj.hf.options.hf_fzc) {
					$(`#frozen-columns-${wid}-${tid}`).prop('checked', true);
				}
				$(`#top-left-${wid}-${tid}`).val(pj.hf.value.top_left)
				$(`#top-middle-${wid}-${tid}`).val(pj.hf.value.top_center)
				$(`#top-right-${wid}-${tid}`).val(pj.hf.value.top_right)
				$(`#bottom-left-${wid}-${tid}`).val(pj.hf.value.bottom_left)
				$(`#bottom-middle-${wid}-${tid}`).val(pj.hf.value.bottom_center)
				$(`#bottom-right-${wid}-${tid}`).val(pj.hf.value.bottom_right)
			}).trigger("click");
			$(`.done-${wid}-${tid}`).on('click', function (e) {
				e.preventDefault()
				e.stopPropagation()
				console.log(JSON.stringify(getEmailValues(wid, tid), null, 4));
				// if (getEmailValues(wid, tid)) {
				// $(`#task-modal-${wid}-${tid}`).modal('hide');
				// }
			})
			var toolbarOptions = ['bold', 'italic', 'underline', 'strike', 'link', 'image', {
				'list': 'ordered'
			}, {
					'list': 'bullet'
				}, {
					size: ['small', false, 'large', 'huge']
				}, {
					'align': []
				}, {
					'direction': 'rtl'
				}, 'clean']
			$(`#editor-${wid}-${tid}, #editor-html-${wid}-${tid}`).css("height", "250px")
			var quill = new Quill(`#editor-${wid}-${tid}`, {
				theme: 'snow',
				placeholder: 'Use HTML tags and {{Column Title}} for composing personalized emails',
				modules: {
					toolbar: toolbarOptions
				}
			});
			var quill = new Quill(`#editor-html-${wid}-${tid}`, {
				theme: 'snow',
				modules: {
					toolbar: false
				}
			});
		}
		// Delete Instance
		$(`.tdelete`).on('click', function (e) {
			$(this).parent().parent().parent().parent().remove();
		})
		$("#email").click(function (event) {
			createTask_Email("l9zgqjql")
		});
		$("#restoreall").click(function (event) {
			$("#tasks-point-l9zgqjql").html('')
			var wflw = {
				id: "l9zgqjql",
				tasks: [{
					"taskType": "email",
					"id": "y9f514dg",
					"name": "l9zgqjql-y9f514dg",
					"taskType": "Email",
					"senderEmail": "somethinggoodone@gmail.com",
					"replyTo": "somethinggoodone@gmail.com",
					"editorType": "wysiwyg",
					"htmlBody": "<p>This is a test email</p>",
					"attachMergedFiles": true,
					"serviceName": "Gmail",
					"senderName": "Anony Dee",
					"subject": "Test subject",
					"to": "to1recipient1@gmail.com,torecipient2@gmail.com",
					"cc": "cc@gmail.com",
					"bcc": "bcc@gmail.com",
					"emailQuestion": "{{Your Fathers email?}}",
					"attachFormUploads": true
				}, {
					"taskType": "email",
					"id": "j2f514dg",
					"name": "l9zgqjql-j2f514dg",
					"taskType": "Email",
					"senderEmail": "tetrahedron@gmail.com",
					"replyTo": "square@gmail.com",
					"editorType": "html",
					"htmlBody": "<p>This is a test email</p><h1>This is heading</h1>",
					"attachMergedFiles": true,
					"serviceName": "Gmail",
					"senderName": "Anony Dee",
					"subject": "Test subject",
					"to": "triangle@gmail.com,pentagon@gmail.com",
					"cc": "cc@gmail.com",
					"bcc": "bcc@gmail.com",
					"emailQuestion": "{{Your Mothers email?}}",
					"attachFormUploads": false
				}]
			}
			wflw.tasks.forEach(t => {
				if (t.taskType == "email") {
					createTask_Email(wflw.id, t)
				}
			})
		});
		$(`#sendall`).click(function (e) {
			r = [];
			error = false;
			$(`#tasks-point-l9zgqjql`).children().each(function () {
				if ($(this).data("type") == "email") {
					var ids = $(this).data("id").split("-");
					var w = getEmailValues(ids[0], ids[1])
					if (!w) {
						$(`#task-modal-${$(this).data("id")}`).modal("show");
						error = true;
						return false;
					} else r.push(w);
				}
			});
			if (!error) console.log(JSON.stringify(r, null, 4))
		});
	</script>
</body>

</html>